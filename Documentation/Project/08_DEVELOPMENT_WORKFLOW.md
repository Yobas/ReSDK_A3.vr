# Процессы разработки

Руководство по базовым процессам разработки проекта.

## Git workflow

### Структура веток

Проект использует упрощенную структуру веток:

- **`main`** - стабильная ветка, содержит готовый проверенный код. Изменения попадают в `main` только через Pull Request'ы после ревью
- **`development`** - присутствует в репозитории, но не используется активно

**Важно:** `main` - это защищенная ветка. Прямые коммиты в `main` не допускаются (за исключением обновления файла версии `Src/VERSION` перед релизом). Все изменения должны проходить через Pull Request'ы.

**Исключения:**
- Обновление файла `Src/VERSION` перед релизом может быть закоммичено напрямую в `main` (если у вас есть права)
- В экстренных случаях мейнтейнеры могут делать прямые коммиты в `main` для срочных патчей (например, критичные исправления безопасности)

### Рабочий процесс

**Основной workflow - работа через ветки и Pull Request'ы:**

Разработчик может работать двумя способами:

#### Вариант 1: Работа в форке репозитория

1. Создайте форк репозитория на GitHub
2. Клонируйте форк локально:
   ```bash
   git clone https://github.com/ваш-username/rvsdk.git
   cd rvsdk
   ```
3. Добавьте upstream репозиторий:
   ```bash
   git remote add upstream https://github.com/основной-репозиторий/rvsdk.git
   ```
4. Создайте ветку для ваших изменений:
   ```bash
   git checkout main
   git pull upstream main
   git checkout -b feature/название-функции
   ```
5. Внесите изменения и закоммитьте:
   ```bash
   git add .
   git commit -m "Краткое описание изменений"
   ```
6. Отправьте изменения в ваш форк:
   ```bash
   git push origin feature/название-функции
   ```
7. Создайте Pull Request в основной репозиторий в ветку `main` через веб-интерфейс GitHub

#### Вариант 2: Работа в ветке основного репозитория

Если у вас есть права на запись в основной репозиторий:

1. Клонируйте репозиторий (если еще не клонирован):
   ```bash
   git clone https://github.com/основной-репозиторий/rvsdk.git
   cd rvsdk
   ```
2. Обновите `main`:
   ```bash
   git checkout main
   git pull origin main
   ```
3. Создайте ветку для ваших изменений:
   ```bash
   git checkout -b feature/название-функции
   ```
4. Внесите изменения и закоммитьте:
   ```bash
   git add .
   git commit -m "Краткое описание изменений"
   ```
5. Отправьте ветку в репозиторий:
   ```bash
   git push origin feature/название-функции
   ```
6. Создайте Pull Request в ветку `main` через веб-интерфейс GitHub

### Формат коммитов

Используйте понятные сообщения коммитов:

- `"Добавлен модуль Inventory"`
- `"Исправлена ошибка загрузки модулей"`
- `"Обновлена документация"`

Опционально можно использовать префиксы для категоризации: `Add:`, `Fix:`, `Update:`, `Docs:`, `Refactor:`

### Разделение коммитов

Разделяйте изменения на логические коммиты - это облегчает понимание истории изменений и откат при необходимости:

```bash
# Хорошо - отдельные коммиты
git add module1.sqf
git commit -m "Add: новый модуль"

git add module2.sqf
git commit -m "Add: еще один модуль"

# Плохо - все в одном коммите
git add .
git commit -m "Изменения"
```

## Работа с багами

1. Обсудите баг с командой (или создайте issue на GitHub)
2. Создайте ветку для исправления бага (например, `fix/описание-бага`)
3. Исправьте баг в этой ветке
4. Закоммитьте с понятным описанием исправления
5. Протестируйте исправление перед отправкой
6. Создайте Pull Request в `main`

## Релизный процесс

1. Убедитесь, что все изменения готовы и находятся в `main` (через Pull Request'ы)
2. Обновите версию в `Src/VERSION` согласно семантическому версионированию (см. [Версионирование](07_VERSIONING.md))
3. Закоммитьте обновление версии и создайте Pull Request в `main`, либо (если у вас есть права) закоммитьте напрямую в `main` только обновление версии
4. После мержа обновления версии в `main` опубликуйте релиз через сайт GitHub. 
5. Дождитесь пока сервис обновления соберёт релизную версию и развернёт её на сервере.
6. При необходимости запустите собранную версию

**Примечание:** Changelog генерируется автоматически через GitHub Actions сразу после выпуска релиза (см. [Версионирование](07_VERSIONING.md)). Сервис обновления автоматически собирает релиз при создании тега.

## Разрешение конфликтов

### При работе с Pull Request

Если при создании PR возникают конфликты:

1. Обновите вашу ветку из main:
   ```bash
   git checkout main
   git pull origin main
   git checkout ваша-ветка
   git merge main
   ```
2. Разрешите конфликты в файлах
3. Закоммитьте разрешение: `git commit -m "Resolve merge conflicts"`
4. Отправьте изменения: `git push origin ваша-ветка`

GitHub также позволяет разрешать конфликты через веб-интерфейс.

### При обновлении вашей ветки из main

Если при обновлении вашей рабочей ветки из `main` возникают конфликты:

```bash
# Обновите main
git checkout main
git pull origin main

# Вернитесь в вашу ветку
git checkout ваша-ветка

# Смержите изменения из main
git merge main

# Разрешите конфликты в файлах
# ...

# Добавьте разрешенные файлы
git add .

# Завершите merge
git commit -m "Merge main into ваша-ветка"
```

## Лучшие практики

### Регулярные обновления

Регулярно синхронизируйте вашу рабочую ветку с `main`:

```bash
# Обновите main
git checkout main
git pull origin main

# Вернитесь в вашу рабочую ветку
git checkout ваша-ветка

# Смержите изменения из main (если нужно)
git merge main
```

> [!WARNING]
> Не используйте rebase для слияния изменений из main в вашу рабочую ветку. Это может привести к конфликтам и сложностям в обратном слиянии.

### Мелкие коммиты

Делайте небольшие, логические коммиты вместо больших:

```bash
# Хорошо
git commit -m "Add: функция A"
git commit -m "Add: функция B"

# Плохо
git commit -m "Все изменения"
```

### Тестирование

Перед коммитом убедитесь, что:
- Код компилируется без ошибок
- Изменения не ломают существующую функциональность
- Проведено базовое тестирование (если применимо)

### Документация

При изменении API или добавлении новых функций обновляйте соответствующую документацию.

## Что дальше?

- ➡️ [Стандарты кодирования](09_CODING_STANDARDS.md) - правила написания кода
- ➡️ [Версионирование](07_VERSIONING.md) - процесс создания релизов
